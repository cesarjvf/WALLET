<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Entrop√≠a BIP39 | Suite de Investigaci√≥n</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js"></script>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --terminal-green: #00ff41;
            --terminal-dim: #008F11;
            --alert-color: #ff3333;
            --warning-color: #ffcc00;
            --panel-bg: #1a1a1a;
            --input-bg: #222;
        }

        body {
            background-color: var(--bg-color);
            color: var(--terminal-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh; /* Permite crecer si es necesario */
            overflow-y: auto;  /* ACTIVA EL SCROLL VERTICAL SI NO CABE */
        }

        header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--terminal-dim);
            width: 100%;
            max-width: 900px;
            padding-bottom: 5px;
            flex-shrink: 0;
        }

        h1 { font-size: 1.2rem; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        .subtitle { font-size: 0.7rem; color: var(--terminal-dim); }

        /* Contenedor Principal */
        #workspace {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 900px;
            /* Eliminamos height: 100% fijo para evitar cortes */
            gap: 15px;
            margin-bottom: 20px; /* Espacio al final para scroll c√≥modo */
        }

        /* Panel Superior */
        #top-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #stats-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .stat-box {
            border: 1px solid var(--terminal-dim);
            padding: 5px;
            text-align: center;
            background: #111;
        }

        .stat-value { font-size: 1.2rem; font-weight: bold; }
        .stat-label { font-size: 0.6rem; color: #888; text-transform: uppercase; }

        /* Configuraci√≥n de Objetivo */
        #target-config {
            background: var(--input-bg);
            border: 1px solid #444;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        #target-config label { font-size: 0.8rem; color: var(--terminal-dim); font-weight: bold; }
        
        #target-input {
            background: #000;
            border: 1px solid #555;
            color: white;
            padding: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            width: 100%;
            box-sizing: border-box;
        }
        #target-input:focus { outline: none; border-color: var(--terminal-green); }

        /* Panel Central: Log R√°pido */
        #scan-panel {
            background-color: var(--panel-bg);
            border: 1px solid var(--terminal-dim);
            padding: 10px;
            overflow-y: auto;
            font-size: 0.8rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            height: 250px; /* Altura fija c√≥moda pero scrolleable internamente */
            min-height: 150px;
        }

        /* Panel Inferior: TESOROS */
        #treasure-panel {
            background-color: #2a0a0a;
            border: 2px solid var(--alert-color);
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 180px; /* Un poco m√°s alto para ver mejor */
            position: relative;
        }

        #treasure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            color: var(--alert-color);
            font-weight: bold;
        }

        #found-keys {
            width: 100%;
            flex-grow: 1;
            background: black;
            color: var(--terminal-green);
            border: 1px solid #555;
            padding: 10px;
            font-family: monospace;
            resize: none;
            font-size: 0.8rem;
        }

        /* Elementos UI */
        .log-entry {
            margin-bottom: 3px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            opacity: 0.7;
        }
        .log-entry.found-alert { opacity: 1; font-weight: bold; background: #300; }

        .mnemonic { color: #aaa; }
        .address { color: #555; font-size: 0.75rem; }
        .checking { color: var(--warning-color); font-style: italic; }

        button {
            background: transparent;
            border: 1px solid var(--terminal-green);
            color: var(--terminal-green);
            padding: 5px 15px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        button:hover { background: var(--terminal-green); color: black; }
        button:disabled { border-color: #444; color: #444; cursor: not-allowed; }

        #controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #222;
            padding: 10px;
            border: 1px solid #444;
            margin-top: 5px;
        }

        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
        input[type="checkbox"] { accent-color: var(--terminal-green); }
        
        /* Mensaje de Error */
        .validation-error {
            color: var(--warning-color);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            border: 1px solid var(--warning-color);
            padding: 5px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--terminal-dim); }
    </style>
</head>
<body>

    <header>
        <h1>Buscador de Entrop√≠a BIP39</h1>
        <div class="subtitle">Herramienta de Investigaci√≥n Criptogr√°fica</div>
    </header>

    <div id="workspace">
        
        <!-- SECCI√ìN SUPERIOR: Configuraci√≥n y Stats -->
        <div id="top-section">
            <div id="stats-panel">
                <div class="stat-box">
                    <div class="stat-value" id="count-gen">0</div>
                    <div class="stat-label">Generadas</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="speed-gen">0</div>
                    <div class="stat-label">Wallets/seg</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="found-count" style="color: var(--alert-color)">0</div>
                    <div class="stat-label">Hallazgos</div>
                </div>
            </div>

            <!-- Configuraci√≥n de Target -->
            <div id="target-config">
                <label>üéØ OBJETIVO OFFLINE (Pega una direcci√≥n ETH 0x...):</label>
                <input type="text" id="target-input" placeholder="0x..." value="0x00000000219ab540356cBB839Cbe05303d7705Fa">
                <div id="btc-warning" class="validation-error">
                    ‚ö†Ô∏è ALERTA: Has pegado una direcci√≥n de Bitcoin. <br>
                    Este buscador usa `ethers.js` y solo puede verificar matem√°ticamente direcciones Ethereum (`0x...`) en modo Offline. <br>
                    Para buscar BTC, usa el "Modo Online" (buscar√° saldo general) o busca la direcci√≥n ETH asociada.
                </div>
            </div>

            <div id="controls">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="chk-online" onchange="toggleMode()">
                    <div>
                        <strong>Modo Online (Lento)</strong><br>
                        <span style="color:#888;">Ignora el objetivo y busca cualquier saldo real (ETH/BTC).</span>
                    </div>
                </div>
                <div>
                    <button id="btn-start" onclick="startMining()">‚ñ∂ INICIAR</button>
                    <button id="btn-stop" onclick="stopMining()" disabled>‚èπ DETENER</button>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN CENTRAL: Log -->
        <div id="scan-panel">
            <div style="color: gray; text-align: center; margin-top: 50px;">
                Define tu objetivo y presiona INICIAR...
            </div>
        </div>

        <!-- SECCI√ìN INFERIOR: Tesoros -->
        <div id="treasure-panel">
            <div id="treasure-header">
                <span>CAJA DE RESULTADOS</span>
                <button onclick="copyTreasures()" style="border-color:var(--alert-color); color:var(--alert-color)">üìã Copiar Todo</button>
            </div>
            <textarea id="found-keys" readonly placeholder="Si alguna semilla coincide con tu OBJETIVO, aparecer√° aqu√≠..."></textarea>
        </div>

    </div>

    <script type="module">
        import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";

        // CONFIGURACI√ìN
        const RPC_URL = "https://eth.llamarpc.com"; 
        
        let provider = null;
        let isRunning = false;
        let generatedCount = 0;
        let startTime = 0;
        let foundCount = 0;
        let currentTarget = "";
        
        // Elementos UI
        const display = document.getElementById('scan-panel');
        const countDisplay = document.getElementById('count-gen');
        const speedDisplay = document.getElementById('speed-gen');
        const foundDisplay = document.getElementById('found-count');
        const btnStart = document.getElementById('btn-start');
        const btnStop = document.getElementById('btn-stop');
        const chkOnline = document.getElementById('chk-online');
        const treasureBox = document.getElementById('found-keys');
        const targetInput = document.getElementById('target-input');
        const btcWarning = document.getElementById('btc-warning');

        // Escuchar cambios en el input para validar en tiempo real
        targetInput.addEventListener('input', validateInput);

        function validateInput() {
            const val = targetInput.value.trim();
            // Detectar si parece una direcci√≥n BTC (empieza con 1, 3 o bc1) y NO es ETH (no empieza con 0x)
            if (!chkOnline.checked && val.length > 0 && !val.startsWith('0x')) {
                btcWarning.style.display = 'block';
                btnStart.disabled = true;
                btnStart.style.opacity = "0.5";
            } else {
                btcWarning.style.display = 'none';
                if (!isRunning) {
                    btnStart.disabled = false;
                    btnStart.style.opacity = "1";
                }
            }
        }

        window.toggleMode = function() {
            targetInput.disabled = chkOnline.checked;
            
            if (chkOnline.checked) {
                targetInput.style.opacity = "0.5";
                btcWarning.style.display = 'none'; // Ocultar warning en online porque ah√≠ no importa el target
                btnStart.disabled = false;
                btnStart.style.opacity = "1";
                
                if (!provider) {
                    try {
                        provider = new ethers.JsonRpcProvider(RPC_URL);
                    } catch(e) {
                        alert("Error de conexi√≥n RPC.");
                        chkOnline.checked = false;
                    }
                }
            } else {
                targetInput.style.opacity = "1";
                targetInput.disabled = false;
                validateInput(); // Re-validar al volver a offline
            }
        }

        window.copyTreasures = function() {
            treasureBox.select();
            document.execCommand('copy');
            alert("Copiado al portapapeles");
        }

        window.startMining = function() {
            if (isRunning) return;
            
            currentTarget = targetInput.value.trim();
            
            // Validaci√≥n final antes de iniciar
            if (!chkOnline.checked) {
                if (currentTarget === "") {
                    alert("Por favor, ingresa una Direcci√≥n Objetivo.");
                    return;
                }
                if (!currentTarget.startsWith('0x')) {
                    alert("ERROR DE PROTOCOLO: En modo Offline solo se pueden buscar direcciones Ethereum (0x...). La direcci√≥n pegada es de Bitcoin.");
                    return;
                }
            }

            if (chkOnline.checked && !provider) {
                provider = new ethers.JsonRpcProvider(RPC_URL);
            }

            isRunning = true;
            btnStart.disabled = true;
            btnStop.disabled = false;
            chkOnline.disabled = true;
            targetInput.disabled = true; 
            
            display.innerHTML = ''; 
            startTime = Date.now();
            
            miningLoop();
        };

        window.stopMining = function() {
            isRunning = false;
            btnStart.disabled = false;
            btnStop.disabled = true;
            chkOnline.disabled = false;
            if(!chkOnline.checked) targetInput.disabled = false;
            speedDisplay.innerText = "0";
            validateInput();
        };

        async function miningLoop() {
            if (!isRunning) return;

            const loops = chkOnline.checked ? 1 : 10; 

            for (let i = 0; i < loops; i++) {
                if (!isRunning) break;

                try {
                    // 1. Generar Mnem√≥nica
                    const wallet = ethers.Wallet.createRandom();
                    const mnemonic = wallet.mnemonic.phrase;
                    
                    // IMPORTANTE: Esto siempre genera una direcci√≥n 0x...
                    const address = wallet.address; 
                    
                    let isMatch = false;
                    let balanceText = "0.00";

                    if (chkOnline.checked) {
                        // MODO ONLINE: Busca saldo real (ETH)
                        const tempDiv = logWallet(mnemonic, address, false, true);
                        try {
                            const balance = await provider.getBalance(address);
                            if (balance > 0n) {
                                isMatch = true;
                                balanceText = ethers.formatEther(balance) + " ETH";
                            }
                            updateLogEntry(tempDiv, isMatch, balanceText, mnemonic);
                        } catch (e) {
                            updateLogEntry(tempDiv, false, "ERR", mnemonic);
                        }
                        i = loops; 
                        await new Promise(r => setTimeout(r, 2000)); 

                    } else {
                        // MODO OFFLINE: Compara Strings (Solo 0x con 0x)
                        if (address.toLowerCase() === currentTarget.toLowerCase()) {
                            isMatch = true;
                            balanceText = "TARGET HIT";
                        }
                        logWallet(mnemonic, address, isMatch, false);
                    }

                    generatedCount++;

                    if (isMatch) {
                        foundCount++;
                        foundDisplay.innerText = foundCount;
                        saveToTreasureBox(mnemonic, address, wallet.privateKey, balanceText);
                        alert("¬°OBJETIVO LOCALIZADO! Revisa la caja inferior.");
                        stopMining(); 
                        return;
                    }

                } catch (err) { console.error(err); }
            }

            updateStats();

            if (isRunning) {
                const nextTick = chkOnline.checked ? 100 : 0;
                setTimeout(miningLoop, nextTick);
            }
        }

        function logWallet(mnemonic, address, winner, isPending) {
            const div = document.createElement('div');
            div.className = winner ? 'log-entry found-alert' : 'log-entry';
            
            const shortAddr = address.substring(0,6) + "..." + address.substring(38);
            const shortMnemonic = mnemonic.split(" ").slice(0,3).join(" ") + "...";
            
            let status = winner ? '!!! MATCH !!!' : '---';
            if (isPending) status = '<span class="checking">Scan...</span>';

            div.innerHTML = `
                <span class="mnemonic">${shortMnemonic}</span>
                <span class="address">${shortAddr}</span>
                <span class="status">${status}</span>
            `;
            
            display.prepend(div);
            if (display.children.length > 30) display.removeChild(display.lastChild);
            return div;
        }

        function updateLogEntry(div, winner, text, fullMnemonic) {
            const statusSpan = div.querySelector('.status');
            if (winner) {
                div.className = 'log-entry found-alert';
                div.querySelector('.mnemonic').innerText = fullMnemonic; 
                statusSpan.innerHTML = `<strong>${text}</strong>`;
                statusSpan.style.color = 'white';
            } else {
                statusSpan.innerText = text;
            }
        }

        function saveToTreasureBox(mnemonic, address, privKey, balance) {
            const entry = `
[${new Date().toLocaleTimeString()}] !!! RESULTADO !!!
--------------------------------------------------
ADDRESS:  ${address}
SEMILLA:  ${mnemonic}
PRIVKEY:  ${privKey}
INFO:     ${balance}
--------------------------------------------------
\n`;
            treasureBox.value += entry;
            treasureBox.scrollTop = treasureBox.scrollHeight;
        }

        function updateStats() {
            countDisplay.innerText = generatedCount.toLocaleString();
            const elapsed = (Date.now() - startTime) / 1000;
            if (elapsed > 0) {
                const speed = generatedCount / elapsed;
                speedDisplay.innerText = speed < 1 ? speed.toFixed(1) : Math.floor(speed);
            }
        }
    </script>
</body>
</html>
