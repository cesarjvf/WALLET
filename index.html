<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Entrop√≠a BIP39 | Suite de Investigaci√≥n</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js"></script>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --terminal-green: #00ff41;
            --terminal-dim: #008F11;
            --alert-color: #ff3333;
            --warning-color: #ffcc00;
            --panel-bg: #1a1a1a;
            --input-bg: #222;
        }

        body {
            background-color: var(--bg-color);
            color: var(--terminal-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--terminal-dim);
            width: 100%;
            max-width: 900px;
            padding-bottom: 5px;
            flex-shrink: 0;
        }

        h1 { font-size: 1.2rem; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        .subtitle { font-size: 0.7rem; color: var(--terminal-dim); }

        /* Contenedor Principal */
        #workspace {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 900px;
            height: 100%;
            gap: 15px;
        }

        /* Panel Superior */
        #top-section {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #stats-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .stat-box {
            border: 1px solid var(--terminal-dim);
            padding: 5px;
            text-align: center;
            background: #111;
        }

        .stat-value { font-size: 1.2rem; font-weight: bold; }
        .stat-label { font-size: 0.6rem; color: #888; text-transform: uppercase; }

        /* Configuraci√≥n de Objetivo (Nuevo) */
        #target-config {
            background: var(--input-bg);
            border: 1px solid #444;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        #target-config label { font-size: 0.8rem; color: var(--terminal-dim); font-weight: bold; }
        
        #target-input {
            background: #000;
            border: 1px solid #555;
            color: white;
            padding: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            width: 100%;
            box-sizing: border-box;
        }
        #target-input:focus { outline: none; border-color: var(--terminal-green); }

        /* Panel Central: Log R√°pido */
        #scan-panel {
            flex-grow: 1;
            background-color: var(--panel-bg);
            border: 1px solid var(--terminal-dim);
            padding: 10px;
            overflow-y: auto;
            font-size: 0.8rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            min-height: 100px;
        }

        /* Panel Inferior: TESOROS */
        #treasure-panel {
            flex-shrink: 0;
            background-color: #2a0a0a;
            border: 2px solid var(--alert-color);
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 150px;
            position: relative;
        }

        #treasure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            color: var(--alert-color);
            font-weight: bold;
        }

        #found-keys {
            width: 100%;
            flex-grow: 1;
            background: black;
            color: var(--terminal-green);
            border: 1px solid #555;
            padding: 10px;
            font-family: monospace;
            resize: none;
            font-size: 0.8rem;
        }

        /* Elementos UI */
        .log-entry {
            margin-bottom: 3px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            opacity: 0.7;
        }
        .log-entry.found-alert { opacity: 1; font-weight: bold; background: #300; }

        .mnemonic { color: #aaa; }
        .address { color: #555; font-size: 0.75rem; }
        .checking { color: var(--warning-color); font-style: italic; }

        button {
            background: transparent;
            border: 1px solid var(--terminal-green);
            color: var(--terminal-green);
            padding: 5px 15px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        button:hover { background: var(--terminal-green); color: black; }
        button:disabled { border-color: #444; color: #444; cursor: not-allowed; }

        #controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #222;
            padding: 10px;
            border: 1px solid #444;
            margin-top: 5px;
        }

        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
        input[type="checkbox"] { accent-color: var(--terminal-green); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; }
    </style>
</head>
<body>

    <header>
        <h1>Buscador de Entrop√≠a BIP39</h1>
        <div class="subtitle">Herramienta de Investigaci√≥n Criptogr√°fica</div>
    </header>

    <div id="workspace">
        
        <!-- SECCI√ìN SUPERIOR: Configuraci√≥n y Stats -->
        <div id="top-section">
            <div id="stats-panel">
                <div class="stat-box">
                    <div class="stat-value" id="count-gen">0</div>
                    <div class="stat-label">Generadas</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="speed-gen">0</div>
                    <div class="stat-label">Wallets/seg</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="found-count" style="color: var(--alert-color)">0</div>
                    <div class="stat-label">Hallazgos</div>
                </div>
            </div>

            <!-- NUEVO: Configuraci√≥n de Target -->
            <div id="target-config">
                <label>üéØ OBJETIVO OFFLINE (Pega aqu√≠ la Address p√∫blica a buscar):</label>
                <input type="text" id="target-input" placeholder="Ej: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa" value="1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa">
            </div>

            <div id="controls">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="chk-online" onchange="toggleMode()">
                    <div>
                        <strong>Modo Online (Lento)</strong><br>
                        <span style="color:#888;">Ignora el objetivo de arriba y busca saldo real en internet.</span>
                    </div>
                </div>
                <div>
                    <button id="btn-start" onclick="startMining()">‚ñ∂ INICIAR</button>
                    <button id="btn-stop" onclick="stopMining()" disabled>‚èπ DETENER</button>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN CENTRAL: Log -->
        <div id="scan-panel">
            <div style="color: gray; text-align: center; margin-top: 50px;">
                Define tu objetivo y presiona INICIAR...
            </div>
        </div>

        <!-- SECCI√ìN INFERIOR: Tesoros -->
        <div id="treasure-panel">
            <div id="treasure-header">
                <span>CAJA DE RESULTADOS</span>
                <button onclick="copyTreasures()" style="border-color:var(--alert-color); color:var(--alert-color)">üìã Copiar Todo</button>
            </div>
            <textarea id="found-keys" readonly placeholder="Si alguna semilla coincide con tu OBJETIVO, aparecer√° aqu√≠..."></textarea>
        </div>

    </div>

    <script type="module">
        import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";

        // CONFIGURACI√ìN
        const RPC_URL = "https://eth.llamarpc.com"; 
        
        // Variables de estado
        let provider = null;
        let isRunning = false;
        let generatedCount = 0;
        let startTime = 0;
        let foundCount = 0;
        let currentTarget = ""; // Aqu√≠ guardaremos lo que escribas
        
        // Elementos UI
        const display = document.getElementById('scan-panel');
        const countDisplay = document.getElementById('count-gen');
        const speedDisplay = document.getElementById('speed-gen');
        const foundDisplay = document.getElementById('found-count');
        const btnStart = document.getElementById('btn-start');
        const btnStop = document.getElementById('btn-stop');
        const chkOnline = document.getElementById('chk-online');
        const treasureBox = document.getElementById('found-keys');
        const targetInput = document.getElementById('target-input');

        window.toggleMode = function() {
            // Deshabilitar input de target si estamos en modo online para evitar confusi√≥n
            targetInput.disabled = chkOnline.checked;
            
            if (chkOnline.checked) {
                targetInput.style.opacity = "0.5";
                if (!provider) {
                    try {
                        provider = new ethers.JsonRpcProvider(RPC_URL);
                    } catch(e) {
                        alert("Error de conexi√≥n RPC.");
                        chkOnline.checked = false;
                    }
                }
            } else {
                targetInput.style.opacity = "1";
                targetInput.disabled = false;
            }
        }

        window.copyTreasures = function() {
            treasureBox.select();
            document.execCommand('copy');
            alert("Copiado al portapapeles");
        }

        window.startMining = function() {
            if (isRunning) return;
            
            // Preparar entorno
            currentTarget = targetInput.value.trim();
            if (!chkOnline.checked && currentTarget === "") {
                alert("Por favor, ingresa una Direcci√≥n Objetivo para el modo Offline.");
                return;
            }

            if (chkOnline.checked && !provider) {
                provider = new ethers.JsonRpcProvider(RPC_URL);
            }

            isRunning = true;
            btnStart.disabled = true;
            btnStop.disabled = false;
            chkOnline.disabled = true;
            targetInput.disabled = true; // Bloquear cambios mientras corre
            
            display.innerHTML = ''; 
            startTime = Date.now();
            
            miningLoop();
        };

        window.stopMining = function() {
            isRunning = false;
            btnStart.disabled = false;
            btnStop.disabled = true;
            chkOnline.disabled = false;
            if(!chkOnline.checked) targetInput.disabled = false;
            speedDisplay.innerText = "0";
        };

        async function miningLoop() {
            if (!isRunning) return;

            // Procesar en lotes peque√±os para no congelar la UI en modo offline
            const loops = chkOnline.checked ? 1 : 10; 

            for (let i = 0; i < loops; i++) {
                if (!isRunning) break;

                try {
                    // 1. Generar
                    const wallet = ethers.Wallet.createRandom();
                    const mnemonic = wallet.mnemonic.phrase;
                    const address = wallet.address;
                    
                    // NOTA T√âCNICA: Ethers genera direcciones ETH (0x...). 
                    // Si tu objetivo es una direcci√≥n BTC (1A... o bc1...), la comparaci√≥n directa fallar√° 
                    // porque derivar BTC en JS puro es muy pesado para este archivo.
                    // PERO: Si buscas una direcci√≥n ETH perdida, esto funciona perfecto.
                    
                    let isMatch = false;
                    let balanceText = "0.00";

                    // 2. Verificar
                    if (chkOnline.checked) {
                        // MODO ONLINE
                        const tempDiv = logWallet(mnemonic, address, false, true);
                        try {
                            const balance = await provider.getBalance(address);
                            if (balance > 0n) {
                                isMatch = true;
                                balanceText = ethers.formatEther(balance) + " ETH";
                            }
                            updateLogEntry(tempDiv, isMatch, balanceText, mnemonic);
                        } catch (e) {
                            updateLogEntry(tempDiv, false, "ERR", mnemonic);
                        }
                        // Break loop para esperar el delay
                        i = loops; 
                        await new Promise(r => setTimeout(r, 2000)); 

                    } else {
                        // MODO OFFLINE (Target Match)
                        // Comparamos strings. Ignoramos may√∫sculas/min√∫sculas para ETH (checksum)
                        if (address.toLowerCase() === currentTarget.toLowerCase()) {
                            isMatch = true;
                            balanceText = "TARGET HIT";
                        }
                        logWallet(mnemonic, address, isMatch, false);
                    }

                    generatedCount++;

                    // 3. √âxito
                    if (isMatch) {
                        foundCount++;
                        foundDisplay.innerText = foundCount;
                        saveToTreasureBox(mnemonic, address, wallet.privateKey, balanceText);
                        alert("¬°OBJETIVO LOCALIZADO! Revisa la caja inferior.");
                        stopMining(); // Detener al encontrar el objetivo
                        return;
                    }

                } catch (err) { console.error(err); }
            }

            updateStats();

            if (isRunning) {
                const nextTick = chkOnline.checked ? 100 : 0;
                setTimeout(miningLoop, nextTick);
            }
        }

        function logWallet(mnemonic, address, winner, isPending) {
            const div = document.createElement('div');
            div.className = winner ? 'log-entry found-alert' : 'log-entry';
            
            const shortAddr = address.substring(0,6) + "..." + address.substring(38);
            const shortMnemonic = mnemonic.split(" ").slice(0,3).join(" ") + "...";
            
            let status = winner ? '!!! MATCH !!!' : '---';
            if (isPending) status = '<span class="checking">Scan...</span>';

            div.innerHTML = `
                <span class="mnemonic">${shortMnemonic}</span>
                <span class="address">${shortAddr}</span>
                <span class="status">${status}</span>
            `;
            
            display.prepend(div);
            if (display.children.length > 30) display.removeChild(display.lastChild);
            return div;
        }

        function updateLogEntry(div, winner, text, fullMnemonic) {
            const statusSpan = div.querySelector('.status');
            if (winner) {
                div.className = 'log-entry found-alert';
                div.querySelector('.mnemonic').innerText = fullMnemonic; 
                statusSpan.innerHTML = `<strong>${text}</strong>`;
                statusSpan.style.color = 'white';
            } else {
                statusSpan.innerText = text;
            }
        }

        function saveToTreasureBox(mnemonic, address, privKey, balance) {
            const entry = `
[${new Date().toLocaleTimeString()}] !!! OBJETIVO ENCONTRADO !!!
--------------------------------------------------
TARGET:   ${currentTarget}
ADDRESS:  ${address}
SEMILLA:  ${mnemonic}
PRIVKEY:  ${privKey}
INFO:     ${balance}
--------------------------------------------------
\n`;
            treasureBox.value += entry;
            treasureBox.scrollTop = treasureBox.scrollHeight;
        }

        function updateStats() {
            countDisplay.innerText = generatedCount.toLocaleString();
            const elapsed = (Date.now() - startTime) / 1000;
            if (elapsed > 0) {
                const speed = generatedCount / elapsed;
                speedDisplay.innerText = speed < 1 ? speed.toFixed(1) : Math.floor(speed);
            }
        }
    </script>
</body>
</html>
