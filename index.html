<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Entrop√≠a BIP39 | Esc√°ner Multi-Cadena</title>
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js"></script>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --terminal-green: #00ff41;
            --terminal-dim: #008F11;
            --alert-color: #ff3333;
            --warning-color: #ffcc00;
            --info-color: #00ccff; 
            --bsc-color: #f3ba2f; /* Color Binance */
            --matic-color: #8247e5; /* Color Polygon */
            --panel-bg: #1a1a1a;
            --input-bg: #222;
        }

        body {
            background-color: var(--bg-color);
            color: var(--terminal-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-y: auto;
        }

        header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--terminal-dim);
            width: 100%;
            max-width: 900px;
            padding-bottom: 5px;
            flex-shrink: 0;
        }

        h1 { font-size: 1.2rem; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        .subtitle { font-size: 0.7rem; color: var(--terminal-dim); }

        #workspace {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 900px;
            gap: 15px;
            margin-bottom: 20px;
        }

        #top-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #stats-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .stat-box {
            border: 1px solid var(--terminal-dim);
            padding: 5px;
            text-align: center;
            background: #111;
        }

        .stat-value { font-size: 1.2rem; font-weight: bold; }
        .stat-label { font-size: 0.6rem; color: #888; text-transform: uppercase; }

        #target-config {
            background: var(--input-bg);
            border: 1px solid #444;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        #target-config label { font-size: 0.8rem; color: var(--terminal-dim); font-weight: bold; }
        
        #target-input {
            background: #000;
            border: 1px solid #555;
            color: white;
            padding: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            width: 100%;
            box-sizing: border-box;
        }
        #target-input:focus { outline: none; border-color: var(--terminal-green); }

        #scan-panel {
            background-color: var(--panel-bg);
            border: 1px solid var(--terminal-dim);
            padding: 10px;
            overflow-y: auto;
            font-size: 0.8rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            height: 250px;
            min-height: 150px;
        }

        #treasure-panel {
            background-color: #2a0a0a;
            border: 2px solid var(--alert-color);
            padding: 10px;
            display: flex;
            flex-direction: column;
            height: 180px;
            position: relative;
        }

        #treasure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            color: var(--alert-color);
            font-weight: bold;
        }

        #found-keys {
            width: 100%;
            flex-grow: 1;
            background: black;
            color: var(--terminal-green);
            border: 1px solid #555;
            padding: 10px;
            font-family: monospace;
            resize: none;
            font-size: 0.8rem;
        }

        /* Elementos UI */
        .log-entry {
            margin-bottom: 3px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center; 
            opacity: 0.8;
            padding: 2px 0;
        }
        .log-entry.found-alert { opacity: 1; font-weight: bold; background: #300; }

        .tag-type {
            font-size: 0.6rem;
            padding: 1px 4px;
            border-radius: 3px;
            margin-right: 8px;
            min-width: 35px;
            text-align: center;
            display: inline-block;
        }
        .tag-12 { background-color: #222; border: 1px solid #555; color: #ccc; }
        .tag-24 { background-color: #003366; border: 1px solid var(--info-color); color: var(--info-color); }

        .mnemonic-container { flex-grow: 1; display: flex; align-items: center; overflow: hidden; }
        .mnemonic { color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-right: 10px; }
        
        .address { color: #555; font-size: 0.75rem; width: 140px; text-align: right; flex-shrink: 0; font-family: monospace; }
        .status { width: 100px; text-align: right; flex-shrink: 0; font-size: 0.75rem; }
        
        .checking { color: var(--warning-color); font-style: italic; }
        
        /* Colores de cadenas */
        .chain-eth { color: #fff; }
        .chain-bsc { color: var(--bsc-color); }
        .chain-poly { color: var(--matic-color); }

        button {
            background: transparent;
            border: 1px solid var(--terminal-green);
            color: var(--terminal-green);
            padding: 5px 15px;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        button:hover { background: var(--terminal-green); color: black; }
        button:disabled { border-color: #444; color: #444; cursor: not-allowed; }

        #controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #222;
            padding: 10px;
            border: 1px solid #444;
            margin-top: 5px;
        }

        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
        input[type="checkbox"] { accent-color: var(--terminal-green); }
        
        .validation-error {
            color: var(--warning-color);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            border: 1px solid var(--warning-color);
            padding: 5px;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--terminal-dim); }
    </style>
</head>
<body>

    <header>
        <h1>Buscador BIP39 | Multi-Chain</h1>
        <div class="subtitle">ETH ‚Ä¢ BSC ‚Ä¢ POLYGON | 12 & 24 Words</div>
    </header>

    <div id="workspace">
        
        <div id="top-section">
            <div id="stats-panel">
                <div class="stat-box">
                    <div class="stat-value" id="count-gen">0</div>
                    <div class="stat-label">Generadas</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="speed-gen">0</div>
                    <div class="stat-label">Wallets/seg</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="found-count" style="color: var(--alert-color)">0</div>
                    <div class="stat-label">Hallazgos</div>
                </div>
            </div>

            <div id="target-config">
                <label>üéØ OBJETIVO OFFLINE (Pega una direcci√≥n ETH/BSC/MATIC 0x...):</label>
                <input type="text" id="target-input" placeholder="0x..." value="0xdadb0d80178819f2319190d340ce9a924f783711">
                <div id="btc-warning" class="validation-error">
                    ‚ö†Ô∏è ALERTA: Has pegado una direcci√≥n de Bitcoin. Solo compatible con redes EVM (0x...).
                </div>
            </div>

            <div id="controls">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="chk-online" onchange="toggleMode()">
                    <div>
                        <strong>Modo Online Multi-Cadena</strong><br>
                        <span style="color:#888;">Busca en ETH, BSC y Polygon a la vez.</span>
                    </div>
                </div>
                <div>
                    <button id="btn-start" onclick="startMining()">‚ñ∂ INICIAR</button>
                    <button id="btn-stop" onclick="stopMining()" disabled>‚èπ DETENER</button>
                </div>
            </div>
        </div>

        <div id="scan-panel">
            <div style="color: gray; text-align: center; margin-top: 50px;">
                Listo para escanear redes EVM...
            </div>
        </div>

        <div id="treasure-panel">
            <div id="treasure-header">
                <span>CAJA DE RESULTADOS</span>
                <button onclick="copyTreasures()" style="border-color:var(--alert-color); color:var(--alert-color)">üìã Copiar Todo</button>
            </div>
            <textarea id="found-keys" readonly placeholder="Resultados de cualquiera de las 3 redes aparecer√°n aqu√≠..."></textarea>
        </div>

    </div>

    <script type="module">
        import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";

        // CONFIGURACI√ìN MULTI-CADENA (RPCS P√∫blicos)
        const CHAINS = {
            ETH: { 
                url: "https://eth.llamarpc.com", 
                symbol: "ETH",
                class: "chain-eth"
            },
            BSC: { 
                url: "https://binance.llamarpc.com", 
                symbol: "BNB",
                class: "chain-bsc"
            },
            POLY: { 
                url: "https://polygon.llamarpc.com", 
                symbol: "MATIC",
                class: "chain-poly"
            }
        };

        let providers = {};
        let isRunning = false;
        let generatedCount = 0;
        let startTime = 0;
        let foundCount = 0;
        let currentTarget = "";
        
        const display = document.getElementById('scan-panel');
        const countDisplay = document.getElementById('count-gen');
        const speedDisplay = document.getElementById('speed-gen');
        const foundDisplay = document.getElementById('found-count');
        const btnStart = document.getElementById('btn-start');
        const btnStop = document.getElementById('btn-stop');
        const chkOnline = document.getElementById('chk-online');
        const treasureBox = document.getElementById('found-keys');
        const targetInput = document.getElementById('target-input');
        const btcWarning = document.getElementById('btc-warning');

        targetInput.addEventListener('input', validateInput);

        function validateInput() {
            const val = targetInput.value.trim();
            if (!chkOnline.checked && val.length > 0 && !val.startsWith('0x')) {
                btcWarning.style.display = 'block';
                btnStart.disabled = true;
                btnStart.style.opacity = "0.5";
            } else {
                btcWarning.style.display = 'none';
                if (!isRunning) {
                    btnStart.disabled = false;
                    btnStart.style.opacity = "1";
                }
            }
        }

        window.toggleMode = function() {
            targetInput.disabled = chkOnline.checked;
            if (chkOnline.checked) {
                targetInput.style.opacity = "0.5";
                btcWarning.style.display = 'none'; 
                btnStart.disabled = false;
                btnStart.style.opacity = "1";
                // Pre-cargar providers si no existen
                initProviders();
            } else {
                targetInput.style.opacity = "1";
                targetInput.disabled = false;
                validateInput(); 
            }
        }

        function initProviders() {
            if (Object.keys(providers).length === 0) {
                try {
                    providers.ETH = new ethers.JsonRpcProvider(CHAINS.ETH.url);
                    providers.BSC = new ethers.JsonRpcProvider(CHAINS.BSC.url);
                    providers.POLY = new ethers.JsonRpcProvider(CHAINS.POLY.url);
                    console.log("Providers Multi-Cadena Iniciados");
                } catch(e) {
                    console.error("Error iniciando providers", e);
                }
            }
        }

        window.copyTreasures = function() {
            treasureBox.select();
            document.execCommand('copy');
            alert("Copiado al portapapeles");
        }

        window.startMining = function() {
            if (isRunning) return;
            
            currentTarget = targetInput.value.trim();
            
            if (!chkOnline.checked) {
                if (currentTarget === "") {
                    alert("Por favor, ingresa una Direcci√≥n Objetivo.");
                    return;
                }
                if (!currentTarget.startsWith('0x')) {
                    alert("ERROR: En modo Offline solo direcciones EVM (0x...).");
                    return;
                }
            } else {
                initProviders();
            }

            isRunning = true;
            btnStart.disabled = true;
            btnStop.disabled = false;
            chkOnline.disabled = true;
            targetInput.disabled = true; 
            
            display.innerHTML = ''; 
            startTime = Date.now();
            
            miningLoop();
        };

        window.stopMining = function() {
            isRunning = false;
            btnStart.disabled = false;
            btnStop.disabled = true;
            chkOnline.disabled = false;
            if(!chkOnline.checked) targetInput.disabled = false;
            speedDisplay.innerText = "0";
            validateInput();
        };

        async function miningLoop() {
            if (!isRunning) return;

            // En modo Online, reducimos el batch size porque hacemos 3 llamadas por wallet
            const loops = chkOnline.checked ? 1 : 5; 

            for (let i = 0; i < loops; i++) {
                if (!isRunning) break;

                try {
                    // Generaci√≥n Probabil√≠stica (12 vs 24 palabras)
                    const entropyBytes = Math.random() > 0.5 ? 16 : 32; 
                    const is24Words = entropyBytes === 32;
                    const mnemonicObj = ethers.Mnemonic.fromEntropy(ethers.randomBytes(entropyBytes));
                    const mnemonicPhrase = mnemonicObj.phrase;
                    
                    const wallet = ethers.Wallet.fromPhrase(mnemonicPhrase);
                    const address = wallet.address; 
                    
                    let isMatch = false;
                    let balanceInfo = "0.00";

                    if (chkOnline.checked) {
                        // MODO ONLINE: Multi-Chain Scan
                        const tempDiv = logWallet(mnemonicPhrase, address, false, true, is24Words);
                        
                        try {
                            // Consultamos las 3 redes en paralelo para ahorrar tiempo
                            const [balETH, balBSC, balPOLY] = await Promise.all([
                                providers.ETH.getBalance(address).catch(()=>0n),
                                providers.BSC.getBalance(address).catch(()=>0n),
                                providers.POLY.getBalance(address).catch(()=>0n)
                            ]);

                            if (balETH > 0n) {
                                isMatch = true;
                                balanceInfo = formatBal(balETH, "ETH");
                            } else if (balBSC > 0n) {
                                isMatch = true;
                                balanceInfo = formatBal(balBSC, "BNB");
                            } else if (balPOLY > 0n) {
                                isMatch = true;
                                balanceInfo = formatBal(balPOLY, "MATIC");
                            }

                            updateLogEntry(tempDiv, isMatch, balanceInfo, mnemonicPhrase);

                        } catch (e) {
                            updateLogEntry(tempDiv, false, "ERR NET", mnemonicPhrase);
                        }
                        
                        // Delay obligatorio para no saturar los 3 RPCs
                        i = loops; 
                        await new Promise(r => setTimeout(r, 2500)); 

                    } else {
                        // MODO OFFLINE (Target Match)
                        if (address.toLowerCase() === currentTarget.toLowerCase()) {
                            isMatch = true;
                            balanceInfo = "TARGET HIT";
                        }
                        logWallet(mnemonicPhrase, address, isMatch, false, is24Words);
                    }

                    generatedCount++;

                    if (isMatch) {
                        foundCount++;
                        foundDisplay.innerText = foundCount;
                        saveToTreasureBox(mnemonicPhrase, address, wallet.privateKey, balanceInfo);
                        alert("¬°ENCONTRADO! Saldo detectado en " + balanceInfo);
                        stopMining(); 
                        return;
                    }

                } catch (err) { console.error(err); }
            }

            updateStats();

            if (isRunning) {
                const nextTick = chkOnline.checked ? 100 : 0;
                setTimeout(miningLoop, nextTick);
            }
        }

        function formatBal(wei, symbol) {
            const val = ethers.formatEther(wei);
            // Cortar decimales largos
            return parseFloat(val).toFixed(4) + " " + symbol;
        }

        function logWallet(mnemonic, address, winner, isPending, is24Words) {
            const div = document.createElement('div');
            div.className = winner ? 'log-entry found-alert' : 'log-entry';
            
            const shortAddr = address.substring(0,6) + "..." + address.substring(38);
            const words = mnemonic.split(" ");
            const shortMnemonic = `${words[0]} ${words[1]} ... ${words[words.length-1]}`;
            
            let status = winner ? '!!! MATCH !!!' : '0.00';
            if (isPending) status = '<span class="checking">Scan...</span>';

            const tagClass = is24Words ? 'tag-24' : 'tag-12';
            const tagName = is24Words ? '24W' : '12W';

            div.innerHTML = `
                <div class="mnemonic-container">
                    <span class="tag-type ${tagClass}">${tagName}</span>
                    <span class="mnemonic">${shortMnemonic}</span>
                </div>
                <span class="address">${shortAddr}</span>
                <span class="status">${status}</span>
            `;
            
            display.prepend(div);
            if (display.children.length > 30) display.removeChild(display.lastChild);
            return div;
        }

        function updateLogEntry(div, winner, text, fullMnemonic) {
            const statusSpan = div.querySelector('.status');
            if (winner) {
                div.className = 'log-entry found-alert';
                div.querySelector('.mnemonic').innerText = fullMnemonic; 
                statusSpan.innerHTML = `<strong>${text}</strong>`;
                
                // Color espec√≠fico seg√∫n la moneda encontrada
                if(text.includes("ETH")) statusSpan.classList.add("chain-eth");
                if(text.includes("BNB")) statusSpan.style.color = "var(--bsc-color)";
                if(text.includes("MATIC")) statusSpan.style.color = "var(--matic-color)";

            } else {
                statusSpan.innerText = text;
            }
        }

        function saveToTreasureBox(mnemonic, address, privKey, balance) {
            const wordCount = mnemonic.split(" ").length;
            const entry = `
[${new Date().toLocaleTimeString()}] !!! RESULTADO (${wordCount} WORDS) !!!
--------------------------------------------------
BALANCE:  ${balance}
ADDRESS:  ${address}
SEMILLA:  ${mnemonic}
PRIVKEY:  ${privKey}
--------------------------------------------------
\n`;
            treasureBox.value += entry;
            treasureBox.scrollTop = treasureBox.scrollHeight;
        }

        function updateStats() {
            countDisplay.innerText = generatedCount.toLocaleString();
            const elapsed = (Date.now() - startTime) / 1000;
            if (elapsed > 0) {
                const speed = generatedCount / elapsed;
                speedDisplay.innerText = speed < 1 ? speed.toFixed(1) : Math.floor(speed);
            }
        }
    </script>
</body>
</html>
